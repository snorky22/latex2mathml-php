2026-01-11 19:15

- Fixed "persistent HTML entities" issue (e.g., `&amp;#x1D4A9;`) in MathML output by using raw UTF-8 characters instead of literal hex entity strings when setting `DOMElement` node values.
- Updated `Converter` and `Tokenizer` to use `mb_chr` for mathematical symbols and special characters. This prevents `DOMDocument::saveXML` from double-escaping the ampersand in manually constructed entities.
- Verified that `\mathcal` and other mathematical symbols now produce raw UTF-8 characters in the output, which is better supported by MS Word and other MathML processors.

2026-01-11 19:10

- Re-implemented HTML entity decoding (both named and decimal) in `Converter::preprocess`. 
- Added support for double-escaped entities (e.g., `&amp;#62;` which becomes `&#62;` then `>`), addressing issues with certain HTML source generators.
- Verified that entities like `&alpha;` or `&#62;` are converted to their UTF-8 equivalents before being processed.

2026-01-11 18:35

- Verified and confirmed that the refined MathML conversion correctly handles complex LaTeX examples (e.g., nested indices in `align` environments) without creating empty placeholders.

2026-01-11 18:30

- Further refined MathML output to eliminate empty placeholders in Word:
    - `align`-like environments: Replaced injected empty `<mi/>` tags with `<mspace width="0em"/>` in even-numbered columns used for alignment.
    - Script Optimization: Updated script conversion logic to detect empty bases. When a base is empty (e.g., in `{_{00}}`), the converter now skips the `msub`/`msup`/`msubsup` wrapper for that specific node and directly processes the indices. This avoids nesting scripts with empty bases, which Word often renders as placeholders.

2026-01-11 18:25

- Fixed empty placeholders in MathML output (e.g. in Word):
    - Arrows (`\xrightarrow` and `\xleftarrow`): Now skip empty mandatory/optional arguments and simplify to a single stretchy `mo` if no arguments are provided, instead of creating `mover`/`munderover` with empty components.
    - Empty Bases/Indices: Now use `<mspace width="0em"/>` instead of an empty `<mi/>` for nodes with an empty token. This provides explicit but invisible content that prevents many processors from rendering empty placeholders.

2026-01-11 17:55

- Fixed XML validity in MathML output:
    - Removed `htmlspecialchars_decode` from `Converter::_convert` to ensure that characters like `<`, `>`, and `&` remain correctly escaped as XML entities (`&lt;`, `&gt;`, `&amp;`).
    - This fixes the "StartTag: invalid element name" and other XML parsing errors in post-processors.
    - Updated `tests/ConverterTest.php` to expect escaped XML entities.

2026-01-11 17:45

- Improved `check_xml_errors.php`:
    - Now parses the input `.txt` file for individual `<math>` expressions instead of validating the whole file.
    - Outputs a detailed HTML report instead of plain text.
    - Includes statistics (total, valid, invalid counts).
    - Continues processing even if an error is found.
    - Provides specific help/advice for common XML errors (e.g., unescaped characters, tag mismatches).

2026-01-11 17:40

- Created `check_xml_errors.php`: A utility script to validate the first `.txt` file in the `tests/` directory as XML and report any parsing errors.

2026-01-11 17:35

- Fixed conversion error for display math containing double brackets `[[...]]` inside LaTeX environments like `equation`.
- Restricted parsing of optional alignment arguments in square brackets to specific environments (array, matrix*, aligned, gathered).

2026-01-11 16:45

- Created `display_html_math.php`: A new script based on `display_math.php` that:
    - Processes the first `.html` file found in the `tests/` directory.
    - Uses `\(` and `\)` as delimiters for inline math.
    - Uses `\[` and `\]` as delimiters for display math.
    - Maintains support for standard LaTeX environments (e.g., `\begin{equation}`).
    - Uses updated regex for extracting math with the new delimiters.
- Created `tests/test_math.html`: A sample HTML file to test the new script, containing inline and display math using the new delimiters.
- Verified the implementation by running `php display_html_math.php`.
